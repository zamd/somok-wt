module.exports=function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}(function(e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))switch(typeof e[r]){case"function":break;case"object":e[r]=function(r){var t=r.slice(1),n=e[r[0]];return function(e,r,o){n.apply(this,[e,r,o].concat(t))}}(e[r]);break;default:e[r]=e[e[r]]}return e}([function(e,r,t){"use strict";"use latest";var n=t(7),o=t(113),i=null,s=function(e,r){return i||(n.defaults({REDIS_HOST:"somok.redis.cache.windows.net",REDIS_AUTH_KEY:"pLtirMHAmglRvKddv2HulvOeEF4iS6OojaadOHyt1Ug=",CLUSTER_MODE:"true",DEBUG:"somok",MAX_USERS:1e3,REDIS_PORT:6379,AUTH0_DOMAIN:e.webtaskContext.secrets.AUTH0_DOMAIN,AUTH0_CLIENT_ID:e.webtaskContext.secrets.AUTH0_CLIENT_ID,AUTH0_CLIENT_SECRET:e.webtaskContext.secrets.AUTH0_CLIENT_SECRET,EXTENSION_SECRET:e.webtaskContext.secrets.EXTENSION_SECRET,NODE_ENV:"production",HOSTING_ENV:"webtask",CLIENT_VERSION:"1.0.0",SMTP_HOST:e.webtaskContext.secrets.SMTP_HOST,SMTP_PORT:e.webtaskContext.secrets.SMTP_PORT,SMTP_SECURE:e.webtaskContext.secrets.SMTP_SECURE,SMTP_AUTH_USER:e.webtaskContext.secrets.SMTP_AUTH_USER,SMTP_AUTH_PASS:e.webtaskContext.secrets.SMTP_AUTH_PASS,WT_URL:e.webtaskContext.secrets.WT_URL}),i=t(46)(e.webtaskContext.storage)),i(e,r)};e.exports=o.fromExpress(function(e,r){return s(e,r)})},function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(e,r){var t=function(e,t){return r(e,t)>>>0};return t.signed=r,t.unsigned=t,t.model=e,t}},function(e,r,t){r.merge=t(82),r.uid=t(112)},function(e,r){e.exports=require("buffer")},function(e,r,t){function n(e,r,t,n){if(!n)switch(r){case"invalid_request":n=400;break;case"unauthorized_client":n=403;break;case"access_denied":n=403;break;case"unsupported_response_type":n=501;break;case"invalid_scope":n=400;break;case"temporarily_unavailable":n=503}o.call(this,e,r,t,n),Error.captureStackTrace(this,arguments.callee),this.name="AuthorizationError"}var o=t(14);n.prototype.__proto__=o.prototype,e.exports=n},function(e,r){e.exports=require("util")},function(e,r){e.exports=require("debug")},function(e,r){e.exports=require("nconf")},function(e,r,t){function n(e,r,t,n){if(!n)switch(r){case"invalid_request":n=400;break;case"invalid_client":n=401;break;case"invalid_grant":n=403;break;case"unauthorized_client":n=403;break;case"unsupported_grant_type":n=501;break;case"invalid_scope":n=400}o.call(this,e,r,t,n),Error.captureStackTrace(this,arguments.callee),this.name="TokenError"}var o=t(14);n.prototype.__proto__=o.prototype,e.exports=n},function(e,r){e.exports=require("url")},function(e,r,t){var n=t(99),o=t(30);r=e.exports=new n,r.Passport=r.Authenticator=n,r.Strategy=t(31),r.strategies={},r.strategies.SessionStrategy=o},function(e,r,t){"use strict";e.exports=t(37).active()},function(e,r,t){"use strict";var n=t(7);e.exports={host:n.get("REDIS_HOST"),port:n.get("REDIS_PORT"),auth_pass:n.get("REDIS_AUTH_KEY")}},function(e,r){function t(e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="ForbiddenError",this.message=e,this.status=403}t.prototype.__proto__=Error.prototype,e.exports=t},function(e,r){function t(e,r,t,n){Error.call(this),this.message=e,this.code=r||"server_error",this.uri=t,this.status=n||500}t.prototype.__proto__=Error.prototype,e.exports=t},function(e,r){e.exports=require("querystring")},function(e,r){e.exports=require("redis")},function(e,r){"use strict";function t(e,r){return Math.floor(Math.random()*(r-e+1))+e}r.uid=function(e){for(var r=[],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,i=0;i<e;++i)r.push(n[t(0,o-1)]);return r.join("")},r.random=t},function(e,r){"use strict";function t(e,r){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var t={},n=r||{},s=e.split(a),u=n.decode||i,c=0;c<s.length;c++){var f=s[c],l=f.indexOf("=");if(!(l<0)){var p=f.substr(0,l).trim(),h=f.substr(++l,f.length).trim();'"'==h[0]&&(h=h.slice(1,-1)),void 0==t[p]&&(t[p]=o(h,u))}}return t}function n(e,r,t){var n=t||{},o=n.encode||s;if("function"!=typeof o)throw new TypeError("option encode is invalid");if(!u.test(e))throw new TypeError("argument name is invalid");var i=o(r);if(i&&!u.test(i))throw new TypeError("argument val is invalid");var a=e+"="+i;if(null!=n.maxAge){var c=n.maxAge-0;if(isNaN(c))throw new Error("maxAge should be a Number");a+="; Max-Age="+Math.floor(c)}if(n.domain){if(!u.test(n.domain))throw new TypeError("option domain is invalid");a+="; Domain="+n.domain}if(n.path){if(!u.test(n.path))throw new TypeError("option path is invalid");a+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");a+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(a+="; HttpOnly"),n.secure&&(a+="; Secure"),n.sameSite){var f="string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite;switch(f){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return a}function o(e,r){try{return r(e)}catch(t){return e}}r.parse=t,r.serialize=n;var i=decodeURIComponent,s=encodeURIComponent,a=/; */,u=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},function(e,r,t){"use strict";var n=t(65),o=t(18),i=e.exports=function(e){this.path="/",this.maxAge=null,this.httpOnly=!0,e&&n(this,e),this.originalMaxAge=void 0==this.originalMaxAge?this.maxAge:this.originalMaxAge};i.prototype={set expires(e){this._expires=e,this.originalMaxAge=this.maxAge},get expires(){return this._expires},set maxAge(e){this.expires="number"==typeof e?new Date(Date.now()+e):e},get maxAge(){return this.expires instanceof Date?this.expires.valueOf()-Date.now():this.expires},get data(){return{originalMaxAge:this.originalMaxAge,expires:this._expires,secure:this.secure,httpOnly:this.httpOnly,domain:this.domain,path:this.path,sameSite:this.sameSite}},serialize:function(e,r){return o.serialize(e,r,this.data)},toJSON:function(){return this.data}}},function(e,r){"use strict";function t(e,r){if(Object.defineProperty(this,"req",{value:e}),Object.defineProperty(this,"id",{value:e.sessionID}),"object"==typeof r&&null!==r)for(var t in r)t in this||(this[t]=r[t])}function n(e,r,t){Object.defineProperty(e,r,{configurable:!0,enumerable:!1,value:t,writable:!0})}e.exports=t,n(t.prototype,"touch",function(){return this.resetMaxAge()}),n(t.prototype,"resetMaxAge",function(){return this.cookie.maxAge=this.cookie.originalMaxAge,this}),n(t.prototype,"save",function(e){return this.req.sessionStore.set(this.id,this,e||function(){}),this}),n(t.prototype,"reload",function(e){var r=this.req,t=this.req.sessionStore;return t.get(this.id,function(n,o){return n?e(n):o?(t.createSession(r,o),void e()):e(new Error("failed to load session"))}),this}),n(t.prototype,"destroy",function(e){return delete this.req.session,this.req.sessionStore.destroy(this.id,e),this}),n(t.prototype,"regenerate",function(e){return this.req.sessionStore.regenerate(this.req,e),this})},function(e,r,t){"use strict";function n(){i.call(this)}var o=t(19),i=t(107).EventEmitter,s=t(20),a=t(5);e.exports=n,a.inherits(n,i),n.prototype.regenerate=function(e,r){var t=this;this.destroy(e.sessionID,function(n){t.generate(e),r(n)})},n.prototype.load=function(e,r){var t=this;this.get(e,function(n,o){if(n)return r(n);if(!o)return r();var i={sessionID:e,sessionStore:t};r(null,t.createSession(i,o))})},n.prototype.createSession=function(e,r){var t=r.cookie.expires,n=r.cookie.originalMaxAge;return r.cookie=new o(r.cookie),"string"==typeof t&&(r.cookie.expires=new Date(t)),r.cookie.originalMaxAge=n,e.session=new s(e,r),e.session}},function(e,r){function t(e){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="BadRequestError",this.message=e,this.status=400}t.prototype.__proto__=Error.prototype,e.exports=t},function(e,r,t){var n=(t(9),t(15),t(26));e.exports=function(e){e=e||{};var r=e.mode||"direct",o=e.fragment||["token"],i=e.modes||{};return i.query||(i.query=t(25)),i.fragment||(i.fragment=t(24)),function(e,t,s,a){if("direct"==r){e.status&&(s.statusCode=e.status),(!s.statusCode||s.statusCode<400)&&(s.statusCode=500),401==s.statusCode;var u={};return u.error=e.code||"server_error",e.message&&(u.error_description=e.message),e.uri&&(u.error_uri=e.uri),s.setHeader("Content-Type","application/json"),s.end(JSON.stringify(u))}if("indirect"==r){if(!t.oauth2||!t.oauth2.redirectURI)return a(e);var c="query";if(t.oauth2.req){var f=new n(t.oauth2.req.type);f.containsAny(o)&&(c="fragment"),t.oauth2.req.responseMode&&(c=t.oauth2.req.responseMode)}var l=i[c],p={};return l?(p.error=e.code||"server_error",e.message&&(p.error_description=e.message),e.uri&&(p.error_uri=e.uri),t.oauth2.req&&t.oauth2.req.state&&(p.state=t.oauth2.req.state),l(t.oauth2,s,p)):a(e)}return a(e)}}},function(e,r,t){var n=t(9),o=t(15);r=e.exports=function(e,r,t){var i=n.parse(e.redirectURI);i.hash=o.stringify(t);var s=n.format(i);return r.redirect(s)},r.validate=function(e){if(!e.redirectURI)throw new Error("Unable to issue redirect for OAuth 2.0 transaction")}},function(e,r,t){var n=t(9);r=e.exports=function(e,r,t){var o=n.parse(e.redirectURI,!0);delete o.search,Object.keys(t).forEach(function(e){o.query[e]=t[e]});var i=n.format(o);return r.redirect(i)},r.validate=function(e){if(!e.redirectURI)throw new Error("Unable to issue redirect for OAuth 2.0 transaction")}},function(e,r){function t(e){"string"==typeof e&&(e=e.split(" ")),this._items=e||[],this.__defineGetter__("length",this._length)}t.prototype.equalTo=function(e){if(e instanceof t||(e=new t(e)),this.length!=e.length)return!1;for(var r=0,n=this._items.length;r<n;r++){var o=this._items[r];if(e._items.indexOf(o)==-1)return!1}return!0},t.prototype.contains=function(e){return this._items.indexOf(e)!=-1},t.prototype.containsAny=function(e){for(var r=0,t=e.length;r<t;r++)if(this._items.indexOf(e[r])!=-1)return!0;return!1},t.prototype.toString=function(){return this._items.join(" ")},t.prototype._length=function(){return this._items.length},e.exports=t},[114,94],function(e,r,t){var n=t(102),o=t(101);r=e.exports=function(){return r.__monkeypatchNode(),{initialize:n,authenticate:o}},r.__monkeypatchNode=function(){var e=t(35),r=t(29);e.IncomingMessage.prototype.login=e.IncomingMessage.prototype.logIn=r.logIn,e.IncomingMessage.prototype.logout=e.IncomingMessage.prototype.logOut=r.logOut,e.IncomingMessage.prototype.isAuthenticated=r.isAuthenticated,e.IncomingMessage.prototype.isUnauthenticated=r.isUnauthenticated}},function(e,r){var t=r=e.exports={};t.login=t.logIn=function(e,r,t){"function"==typeof r&&(t=r,r={}),r=r||{};var n="user";this._passport&&this._passport.instance&&(n=this._passport.instance._userProperty||"user");var o=void 0===r.session||r.session;if(this[n]=e,o){if(!this._passport)throw new Error("passport.initialize() middleware not in use");if("function"!=typeof t)throw new Error("req#login requires a callback function");var i=this;this._passport.instance.serializeUser(e,this,function(e,r){return e?(i[n]=null,t(e)):(i._passport.session||(i._passport.session={}),i._passport.session.user=r,i.session||(i.session={}),i.session[i._passport.instance._key]=i._passport.session,void t())})}else t&&t()},t.logout=t.logOut=function(){var e="user";this._passport&&this._passport.instance&&(e=this._passport.instance._userProperty||"user"),this[e]=null,this._passport&&this._passport.session&&delete this._passport.session.user},t.isAuthenticated=function(){var e="user";return this._passport&&this._passport.instance&&(e=this._passport.instance._userProperty||"user"),!!this[e]},t.isUnauthenticated=function(){return!this.isAuthenticated()}},function(e,r,t){function n(){s.call(this),this.name="session"}var o=t(111),i=t(5),s=t(31);i.inherits(n,s),n.prototype.authenticate=function(e,r){if(!e._passport)return this.error(new Error("passport.initialize() middleware not in use"));r=r||{};var t,n=this;if(e._passport.session&&(t=e._passport.session.user),t||0===t){var i=r.pauseStream?o(e):null;e._passport.instance.deserializeUser(t,e,function(r,t){if(r)return n.error(r);if(!t)return delete e._passport.session.user,n.pass(),void(i&&i.resume());var o=e._passport.instance._userProperty||"user";e[o]=t,n.pass(),i&&i.resume()})}else n.pass()},e.exports=n},[114,103],function(e,r){e.exports=require("async")},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("http")},function(e,r,t){"use strict";var n=t(10),o=t(83),i=t(87),s=t(91).BasicStrategy,a=t(95).Strategy,u=(t(6)("somok"),t(11)),c=t(7),f=t(17).random;n.use(new i(function(e,r){u.grants.findOne({token:e},function(e,t){return e?r(e,null):void r(null,t.user)})})),n.use("autoAuth",new o(function(e,r){var t=f(1,parseInt(c.get("MAX_USERS")));console.log('authenticating: getting user:id "'+t+'"...'),u.users.get(t,function(e,t){return e?cb(e,null):void r(null,{username:t.username,id:t.id})})})),n.use(new s(function(e,r,t){return t(null,{id:e})})),n.use(new a(function(e,r,t){return t(null,{id:e})}))},function(e,r,t){"use strict";var n=t(6)("somok"),o=t(7);e.exports.active=function(){return"true"==o.get("CLUSTER_MODE").toLowerCase()?(n("Active Provider: Redis"),t(41)):(n("Active Provider: Inproc(loki)"),t(38))}},function(e,r,t){"use strict";var n=t(109),o=t(39),i=new n,s=i.addCollection("profiles"),a=i.addCollection("users"),u=i.addCollection("grants");u.ensureIndex("code"),u.ensureIndex("token"),s.ensureIndex("username"),e.exports.users=new o(a),e.exports.profiles=new o(s,(!0)),e.exports.grants=new o(u)},function(e,r){"use strict";function t(e,r){function t(t,n){var o=e.findOne(t);r&&(delete o.meta,delete o.$loki),n(null,o)}function n(r,t){var n=e.insert(r);t(null,n)}function o(r,t){var n=e.update(r);t(null,n)}function i(r,t){var n=e.get(r);t(null,n)}function s(r,t){var n=0;return r.forEach(function(r){var t=e.insert(r);t&&n++}),t(null,n)}function a(r){var t=e.count();r(t)}return{findOne:t,insert:n,update:o,count:a,get:i,"import":s}}e.exports=t},function(e,r,t){"use strict";function n(){function e(e){return"grant."+e}function r(e){return e+".user"}function t(e){return e+".client"}function n(e,n){c.multi().hgetall(e).hgetall(r(e)).hgetall(t(e)).exec(function(e,r){e&&n(e,null);var t=r[0];t.user=r[1],t.client=r[2],n(null,t)})}function a(r,t){r.token?c.get(e(r.token),function(e,r){n(r,function(e,r){t(e,r)})}):n(e(r.code),function(e,r){t(e,r)})}function u(n,o){var i={code:n.code,redirectURI:n.redirectURI},s=n.user,a=n.client,u=e(i.code),f=c.multi();f.hmset(u,i).hmset(r(u),s).hmset(t(u),a),n.token&&(f.hset(u,"token",n.token),f.set(e(n.token),u)),f.exec(function(e,r){return e?o(e,null):void o(null,n)})}if("true"==i.get("CLUSTER_MODE").toLowerCase()){var c=o.createClient(s);return{update:u,insert:u,findOne:a}}}var o=t(16),i=t(7),s=t(12);e.exports=new n},function(e,r,t){"use strict";e.exports.users=t(43),e.exports.profiles=t(42),e.exports.grants=t(40)},function(e,r,t){"use strict";function n(){function e(e){return"profile."+e}function r(r,t){u.hgetall(e(r.username),function(e,r){t(e,r)})}function t(r,t){u.hmset(e(r.username),r,function(e){return e?t(e,null):void t(null,r)})}function n(e,r){var n=e.map(function(e){return function(r){t(e,function(e,t){return e?void r(null,t):r(e,null)})}});i.parallel(n,function(e,t){r(e,t.length)})}if("true"==a.get("CLUSTER_MODE").toLowerCase()){var u=o.createClient(s);return{findOne:r,"import":n}}}var o=t(16),i=t(32),s=t(12),a=t(7);e.exports=new n},function(e,r,t){"use strict";function n(){function e(e,r){n.incr(u,function(t,o){var i=c+o;n.hmset(i,e,function(t){return t?r(t,null):(e._id=i,void r(null,e))})})}function r(e,r){var t=c+e;n.hgetall(t,function(e,t){return e?r(e,null):void r(null,t)})}function t(r,t){var n=r.map(function(r){return function(t){e(r,function(e,r){t(null,r)})}});i.parallel(n,function(e,r){t(e,r.length)})}if("true"==s.get("CLUSTER_MODE").toLowerCase()){var n=o.createClient(a);return n.del(u),{"import":t,get:r}}}var o=t(16),i=t(32),s=t(7),a=t(12),u="user.n",c="user.";e.exports=new n},function(e,r,t){"use strict";var n=t(34).Router();console.log("GOT ROUTER....");var o=t(47);console.log("GOT LIB....");var i=t(10);console.log("GOT passport....");var s=t(45);console.log("GOT PROFILE...."),n.use(i.initialize()),console.log("INIT PASSPORt .."),n.get("/v2.2/dialog/oauth",o.authorizationGrantDirect),n.get("/dialog/oauth",o.authorizationGrantDirect),n.get("/v2.2/oauth/access_token",o.issueToken),n.post("/oauth/access_token",o.token),n.get("/v2.0/me",s.serve),n.get("/v2.5/me",s.serve),console.log("returning router...."),e.exports=n},function(e,r,t){"use strict";var n=t(11),o=(t(6)("somok"),t(10));e.exports.serve=[o.authenticate("bearer",{session:!1}),function(e,r,t){console.log("profile requested for "+e.user.username),n.profiles.findOne({username:e.user.username},function(e,t){return e?r.status(500).send(e):(console.log("returning profile for "+t.username),void r.json(t))})}]},function(e,r,t){"use strict";var n=t(34)(),o=t(48),i=(t(36),t(104));t(6)("somok"),e.exports=function(e){return n.use(function(e,r,t){console.log("RUNNING request...."),t()}),n.use(i.json()),n.use(i.urlencoded({extended:!0})),n.use(o({secret:"3232322",resave:!0,saveUninitialized:!1})),n.use("/",t(44)),n}},function(e,r,t){"use strict";console.log("GETTING OAUTH2AUTHORIZE SERVER....");var n=t(73);console.log("GOT passport....");var o=t(10);console.log("GOT DEBUG...."),t(6)("somok"),console.log("GOT UTILS....");var i=t(17);console.log("GOT DB....");var s=t(11);console.log("createServer ROUTER....");var a=n.createServer();a.grant(n.grant.code(function(e,r,t,n,o){var a=i.uid(32);console.log('granting authorization code "'+a+'" to "'+e.id+'"'),s.grants.insert({code:a,client:e,redirectURI:r,user:t,params:n},function(e,r){return e?o(e,null):void o(null,r.code)})})),a.exchange(n.exchange.code(function(e,r,t,n){console.log('Issuing token for authorization code "'+r+'" to "'+e.id+'"'),s.grants.findOne({code:r},function(e,t){e&&(console.log('no grant found for code "'+r+'"'),n(e,null));var o=i.uid(256);t.token=o,s.grants.update(t,function(e,r){return e?n(e,null):void n(null,r.token)})})})),a.serializeClient(function(e,r){console.log('serializing client "'+e.id+'"...'),r(null,e.id)}),a.deserializeClient(function(e,r){console.log('deserializing client "'+e+'"...'),r(null,{id:e})}),e.exports.authorizationGrantDirect=[o.authenticate("autoAuth",{session:!1}),a.authorization(function(e,r,t){var n={id:e,redirectURI:r};t(null,n,r)}),function(e,r,t){e.query.transaction_id=e.oauth2.transactionID,t()},function(e,r,t){console.log("waiting for RO consent..."),setTimeout(t,1)},a.decision(function(e,r){console.log("processing RO consent approval...");var t=e.oauth2.req;r(null,t)})],e.exports.issueToken=[function(e,r,t){e.body.grant_type="authorization_code",e.body.code=e.query.code,e.body.redirect_uri=e.query.redirect_uri,t()},a.token()],e.exports.token=[o.authenticate(["basic","oauth2-client-password"],{session:!1}),function(e,r,t){console.log("client "+e.user.id+" authenticated..."),t()},a.token()]},function(e,r,t){"use strict";function n(e){var r=e||{},t=r.cookie||{},n=r.genid||o,c=r.name||r.key||"connect.sid",f=r.store||new m,l=r.proxy,y=r.resave,g=Boolean(r.rolling),q=r.saveUninitialized,E=r.secret;if("function"!=typeof n)throw new TypeError("genid option must be a function");if(void 0===y&&(h("undefined resave option; provide resave option"),y=!0),void 0===q&&(h("undefined saveUninitialized option; provide saveUninitialized option"),q=!0),r.unset&&"destroy"!==r.unset&&"keep"!==r.unset)throw new TypeError('unset option must be "destroy" or "keep"');var T="destroy"===r.unset;if(Array.isArray(E)&&0===E.length)throw new TypeError("secret option array must contain one or more strings");E&&!Array.isArray(E)&&(E=[E]),E||h("req.secret; provide secret option"),"production"==x&&f instanceof m&&console.warn(b),f.generate=function(e){e.sessionID=n(e),e.session=new _(e),e.session.cookie=new w(t),"auto"===t.secure&&(e.session.cookie.secure=a(e,l))};var S="function"==typeof f.touch,I=!0;return f.on("disconnect",function(){I=!1}),f.on("connect",function(){I=!0}),function(e,r,n){function o(){f.generate(e),C=e.sessionID,z=s(e.session),h(e.session)}function h(e){function r(){p("saving %s",this.id),U=s(this),t.apply(this,arguments)}var t=e.save;Object.defineProperty(e,"save",{configurable:!0,enumerable:!1,value:r,writable:!0})}function _(e){return C!==e.id||z!==s(e)}function m(e){return C===e.id&&U===s(e)}function w(e){return e.sessionID&&T&&null==e.session}function x(e){return"string"!=typeof e.sessionID?(p("session ignored because of bogus req.sessionID %o",e.sessionID),!1):q||M===e.sessionID?!m(e.session):_(e.session)}function b(e){return"string"!=typeof e.sessionID?(p("session ignored because of bogus req.sessionID %o",e.sessionID),!1):M===e.sessionID&&!x(e)}function A(e){return"string"==typeof e.sessionID&&(M!=e.sessionID?q||_(e.session):g||null!=e.session.cookie.expires&&_(e.session))}if(e.session)return void n();if(!I)return p("store is disconnected"),void n();var O=d.original(e).pathname;if(0!==O.indexOf(t.path||"/"))return n();if(!E&&!e.secret)return void n(new Error("secret option required for sessions"));var z,C,U,R=E||[e.secret],D=!1;e.sessionStore=f;var M=e.sessionID=i(e,c,R);v(r,function(){if(!e.session)return void p("no session");if(A(e)){if(e.session.cookie.secure&&!a(e,l))return void p("not secured");D||(e.session.touch(),D=!0),u(r,c,e.sessionID,R[0],e.session.cookie.data)}});var P=r.end,H=r.write,B=!1;return r.end=function(t,o){function i(){return u?(a=P.call(r,t,o),void(u=!1)):void P.call(r)}function s(){if(!u)return a;if(null==t)return a=!0;var e=Number(r.getHeader("Content-Length"));return!isNaN(e)&&e>0&&(t=Buffer.isBuffer(t)?t:new Buffer(t,o),o=void 0,0!==t.length)?(p("split response"),a=H.call(r,t.slice(0,t.length-1)),t=t.slice(t.length-1,t.length),a):(a=H.call(r,t,o),u=!1,a)}if(B)return!1;B=!0;var a,u=!0;return w(e)?(p("destroying"),f.destroy(e.sessionID,function(e){e&&k(n,e),p("destroyed"),i()}),s()):e.session?(D||(e.session.touch(),D=!0),x(e)?(e.session.save(function(e){e&&k(n,e),i()}),s()):S&&b(e)?(p("touching"),f.touch(e.sessionID,e.session,function(e){e&&k(n,e),p("touched"),i()}),s()):P.call(r,t,o)):(p("no session"),P.call(r,t,o))},e.sessionID?(p("fetching %s",e.sessionID),void f.get(e.sessionID,function(r,t){if(r){if(p("error %j",r),"ENOENT"!==r.code)return void n(r);o()}else t?(p("session found"),f.createSession(e,t),C=e.sessionID,z=s(t),y||(U=z),h(e.session)):(p("no session found"),o());n()})):(p("no SID sent, generating session"),o(),void n())}}function o(e){return y(24)}function i(e,r,t){var n,o,i=e.headers.cookie;if(i){var s=f.parse(i);n=s[r],n&&("s:"===n.substr(0,2)?(o=c(n.slice(2),t),o===!1&&(p("cookie signature invalid"),o=void 0)):p("cookie unsigned"))}return!o&&e.signedCookies&&(o=e.signedCookies[r],o&&h("cookie should be available in req.headers.cookie")),!o&&e.cookies&&(n=e.cookies[r],n&&("s:"===n.substr(0,2)?(o=c(n.slice(2),t),o&&h("cookie should be available in req.headers.cookie"),o===!1&&(p("cookie signature invalid"),o=void 0)):p("cookie unsigned"))),o}function s(e){return l(JSON.stringify(e,function(e,r){if("cookie"!==e)return r}))}function a(e,r){if(e.connection&&e.connection.encrypted)return!0;if(r===!1)return!1;if(r!==!0){var t=e.secure;return"boolean"==typeof t&&t}var n=e.headers["x-forwarded-proto"]||"",o=n.indexOf(","),i=o!==-1?n.substr(0,o).toLowerCase().trim():n.toLowerCase().trim();return"https"===i}function u(e,r,t,n,o){var i="s:"+g.sign(t,n),s=f.serialize(r,i,o);p("set-cookie %s",s);var a=e.getHeader("set-cookie")||[],u=Array.isArray(a)?a.concat(s):Array.isArray(s)?[a].concat(s):[a,s];e.setHeader("set-cookie",u)}function c(e,r){for(var t=0;t<r.length;t++){var n=g.unsign(e,r[t]);if(n!==!1)return n}return!1}var f=t(18),l=t(59).crc32,p=t(6)("express-session"),h=t(106)("express-session"),d=t(61),y=t(62).sync,v=t(60),g=t(105),_=t(20),m=t(66),w=t(19),q=t(21),x="production";r=e.exports=n,r.Store=q,r.Cookie=w,r.Session=_,r.MemoryStore=m;var b="Warning: connect.session() MemoryStore is not\ndesigned for a production environment, as it will leak\nmemory, and will not scale past a single process.",k="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))}},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i);e.exports=(0,s["default"])("crc1",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t=~~r,n=0,i=0;i<e.length;i++){var s=e[i];n+=s}return t+=n%256,t%256})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("crc-16",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t=~~r,n=0;n<e.length;n++){var i=e[n];t=65535&(a[255&(t^i)]^t>>8)}return t})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("ccitt",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t="undefined"!=typeof r?~~r:65535,n=0;n<e.length;n++){var i=e[n];t=65535&(a[255&(t>>8^i)]^t<<8)}return t})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,4489,8978,12955,17956,22445,25910,29887,35912,40385,44890,48851,51820,56293,59774,63735,4225,264,13203,8730,22181,18220,30135,25662,40137,36160,49115,44626,56045,52068,63999,59510,8450,12427,528,5017,26406,30383,17460,21949,44362,48323,36440,40913,60270,64231,51324,55797,12675,8202,4753,792,30631,26158,21685,17724,48587,44098,40665,36688,64495,60006,55549,51572,16900,21389,24854,28831,1056,5545,10034,14011,52812,57285,60766,64727,34920,39393,43898,47859,21125,17164,29079,24606,5281,1320,14259,9786,57037,53060,64991,60502,39145,35168,48123,43634,25350,29327,16404,20893,9506,13483,1584,6073,61262,65223,52316,56789,43370,47331,35448,39921,29575,25102,20629,16668,13731,9258,5809,1848,65487,60998,56541,52564,47595,43106,39673,35696,33800,38273,42778,46739,49708,54181,57662,61623,2112,6601,11090,15067,20068,24557,28022,31999,38025,34048,47003,42514,53933,49956,61887,57398,6337,2376,15315,10842,24293,20332,32247,27774,42250,46211,34328,38801,58158,62119,49212,53685,10562,14539,2640,7129,28518,32495,19572,24061,46475,41986,38553,34576,62383,57894,53437,49460,14787,10314,6865,2904,32743,28270,23797,19836,50700,55173,58654,62615,32808,37281,41786,45747,19012,23501,26966,30943,3168,7657,12146,16123,54925,50948,62879,58390,37033,33056,46011,41522,23237,19276,31191,26718,7393,3432,16371,11898,59150,63111,50204,54677,41258,45219,33336,37809,27462,31439,18516,23005,11618,15595,3696,8185,63375,58886,54429,50452,45483,40994,37561,33584,31687,27214,22741,18780,15843,11370,7921,3960];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("kermit",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t="undefined"!=typeof r?~~r:0,n=0;n<e.length;n++){var i=e[n];t=65535&(a[255&(t^i)]^t>>8)}return t})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("crc-16-modbus",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t="undefined"!=typeof r?~~r:65535,n=0;n<e.length;n++){
var i=e[n];t=65535&(a[255&(t^i)]^t>>8)}return t})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i);e.exports=(0,s["default"])("xmodem",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t="undefined"!=typeof r?~~r:0,n=0;n<e.length;n++){var i=e[n],s=t>>>8&255;s^=255&i,s^=s>>>4,t=t<<8&65535,t^=s,s=s<<5&65535,t^=s,s=s<<7&65535,t^=s}return t})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,8801531,9098509,825846,9692897,1419802,1651692,10452759,10584377,2608578,2839604,11344079,3303384,11807523,12104405,4128302,12930697,4391538,5217156,13227903,5679208,13690003,14450021,5910942,6606768,14844747,15604413,6837830,16197969,7431594,8256604,16494759,840169,9084178,8783076,18463,10434312,1670131,1434117,9678590,11358416,2825259,2590173,10602790,4109873,12122826,11821884,3289031,13213536,5231515,4409965,12912278,5929345,14431610,13675660,5693559,6823513,15618722,14863188,6588335,16513208,8238147,7417269,16212302,1680338,10481449,9664223,1391140,9061683,788936,36926,8838341,12067563,4091408,3340262,11844381,2868234,11372785,10555655,2579964,14478683,5939616,5650518,13661357,5180346,13190977,12967607,4428364,8219746,16457881,16234863,7468436,15633027,6866552,6578062,14816117,1405499,9649856,10463030,1698765,8819930,55329,803287,9047340,11858690,3325945,4072975,12086004,2561507,10574104,11387118,2853909,13647026,5664841,5958079,14460228,4446803,12949160,13176670,5194661,7454091,16249200,16476294,8201341,14834538,6559633,6852199,15647388,3360676,11864927,12161705,4185682,10527045,2551230,2782280,11286707,9619101,1346150,1577872,10379115,73852,8875143,9172337,899466,16124205,7357910,8182816,16421083,6680524,14918455,15678145,6911546,5736468,13747439,14507289,5968354,12873461,4334094,5159928,13170435,4167245,12180150,11879232,3346363,11301036,2767959,2532769,10545498,10360692,1596303,1360505,9604738,913813,9157998,8856728,92259,16439492,8164415,7343561,16138546,6897189,15692510,14936872,6662099,5986813,14488838,13733104,5750795,13156124,5174247,4352529,12855018,2810998,11315341,10498427,2522496,12124823,4148844,3397530,11901793,9135439,862644,110658,8912057,1606574,10407765,9590435,1317464,15706879,6940164,6651890,14889737,8145950,16384229,16161043,7394792,5123014,13133629,12910283,4370992,14535975,5997020,5707818,13718737,2504095,10516836,11329682,2796649,11916158,3383173,4130419,12143240,8893606,129117,876971,9121104,1331783,9576124,10389322,1625009,14908182,6633453,6925851,15721184,7380471,16175372,16402682,8127489,4389423,12891860,13119266,5137369,13704398,5722165,6015427,14517560];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("crc-24",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t="undefined"!=typeof r?~~r:11994318,n=0;n<e.length;n++){var i=e[n];t=16777215&(a[255&(t>>16^i)]^t<<8)}return t})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("crc-32",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t=0===r?0:~~r^-1,n=0;n<e.length;n++){var i=e[n];t=a[255&(t^i)]^t>>>8}return t^-1})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("crc-8",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t=~~r,n=0;n<e.length;n++){var i=e[n];t=255&a[255&(t^i)]}return t})},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var o=t(3),i=t(1),s=n(i),a=[0,94,188,226,97,63,221,131,194,156,126,32,163,253,31,65,157,195,33,127,252,162,64,30,95,1,227,189,62,96,130,220,35,125,159,193,66,28,254,160,225,191,93,3,128,222,60,98,190,224,2,92,223,129,99,61,124,34,192,158,29,67,161,255,70,24,250,164,39,121,155,197,132,218,56,102,229,187,89,7,219,133,103,57,186,228,6,88,25,71,165,251,120,38,196,154,101,59,217,135,4,90,184,230,167,249,27,69,198,152,122,36,248,166,68,26,153,199,37,123,58,100,134,216,91,5,231,185,140,210,48,110,237,179,81,15,78,16,242,172,47,113,147,205,17,79,173,243,112,46,204,146,211,141,111,49,178,236,14,80,175,241,19,77,206,144,114,44,109,51,209,143,12,82,176,238,50,108,142,208,83,13,239,177,240,174,76,18,145,207,45,115,202,148,118,40,171,245,23,73,8,86,180,234,105,55,213,139,87,9,235,181,54,104,138,212,149,203,41,119,244,170,72,22,233,183,85,11,136,214,52,106,43,117,151,201,74,20,246,168,116,42,200,150,21,75,169,247,182,232,10,84,215,137,107,53];"undefined"!=typeof Int32Array&&(a=new Int32Array(a)),e.exports=(0,s["default"])("dallas-1-wire",function(e,r){o.Buffer.isBuffer(e)||(e=(0,o.Buffer)(e));for(var t=~~r,n=0;n<e.length;n++){var i=e[n];t=255&a[255&(t^i)]}return t})},function(e,r,t){"use strict";e.exports={crc1:t(49),crc8:t(57),crc81wire:t(58),crc16:t(50),crc16ccitt:t(51),crc16modbus:t(53),crc16xmodem:t(54),crc16kermit:t(52),crc24:t(55),crc32:t(56)}},function(e,r){"use strict";function t(e,r){var t=!1;return function(o){var i=n.apply(this,arguments);t||(t=!0,r.call(this),"number"==typeof i[0]&&this.statusCode!==i[0]&&(i[0]=this.statusCode,i.length=1)),e.apply(this,i)}}function n(e){var r=arguments.length,t=r>1&&"string"==typeof arguments[1]?2:1,n=r>=t+1?arguments[t]:void 0;if(this.statusCode=e,Array.isArray(n))for(var o=0,i=n.length;o<i;++o)this.setHeader(n[o][0],n[o][1]);else if(n)for(var s=Object.keys(n),o=0;o<s.length;o++){var a=s[o];a&&this.setHeader(a,n[a])}for(var u=new Array(Math.min(r,t)),o=0;o<u.length;o++)u[o]=arguments[o];return u}Array.prototype.slice,e.exports=function(e,r){if(!e)throw new TypeError("argument res is required");if("function"!=typeof r)throw new TypeError("argument listener must be a function");e.writeHead=t(e.writeHead,r)}},function(e,r,t){"use strict";function n(e){var r=e.url;if(void 0!==r){var t=e._parsedUrl;return s(r,t)?t:(t=i(r),t._raw=r,e._parsedUrl=t)}}function o(e){var r=e.originalUrl;if("string"!=typeof r)return n(e);var t=e._parsedOriginalUrl;return s(r,t)?t:(t=i(r),t._raw=r,e._parsedOriginalUrl=t)}function i(e){var r="string"==typeof e&&f.exec(e);if(r){var t=r[1],n=r[2]||null,o=void 0!==c?new c:{};return o.path=e,o.href=e,o.pathname=t,o.search=n,o.query=n&&n.substr(1),o}return u(e)}function s(e,r){return"object"==typeof r&&null!==r&&(void 0===c||r instanceof c)&&r._raw===e}var a=t(9),u=a.parse,c=a.Url,f=/^(\/\/?(?!\/)[^\?#\s]*)(\?[^#\s]*)?$/;e.exports=n,e.exports.original=o},function(e,r,t){"use strict";function n(e,r){if(void 0!==r&&"function"!=typeof r)throw new TypeError("argument callback must be a function");if(!r&&!global.Promise)throw new TypeError("argument callback is required");return r?i(e,r):new Promise(function(r,t){i(e,function(e,n){return e?t(e):void r(n)})})}function o(e){return s(u.sync(e))}function i(e,r){u(e,function(e,t){return e?r(e):void r(null,s(t))})}function s(e){return a(e.toString("base64"))}var a=t(63).escape,u=t(64);e.exports=n,e.exports.sync=o},function(e,r){"use strict";var t=e.exports;t.unescape=function(e){return(e+"===".slice((e.length+3)%4)).replace(/\-/g,"+").replace(/_/g,"/")},t.escape=function(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},t.encode=function(e){return this.escape(new Buffer(e).toString("base64"))},t.decode=function(e){return new Buffer(this.unescape(e),"base64").toString()}},function(e,r,t){"use strict";function n(e,r){if(void 0!==r&&"function"!=typeof r)throw new TypeError("argument callback must be a function");if(!r&&!global.Promise)throw new TypeError("argument callback is required");return r?i(e,a,r):new Promise(function(r,t){i(e,a,function(e,n){return e?t(e):void r(n)})})}function o(e){for(var r=null,t=0;t<a;t++)try{return s.randomBytes(e)}catch(n){r=n}throw r}function i(e,r,t){s.randomBytes(e,function(n,o){return n?--r?void setTimeout(i.bind(null,e,r,t),10):t(n):t(null,o)})}var s=t(33),a=s.randomBytes===s.pseudoRandomBytes?1:3;e.exports=n,e.exports.sync=o},function(e,r){r=e.exports=function(e,r){if(e&&r)for(var t in r)e[t]=r[t];return e}},function(e,r,t){"use strict";function n(){i.call(this),this.sessions=Object.create(null)}function o(e){var r=this.sessions[e];if(r){r=JSON.parse(r);var t="string"==typeof r.cookie.expires?new Date(r.cookie.expires):r.cookie.expires;return t&&t<=Date.now()?void delete this.sessions[e]:r}}var i=t(21),s=t(5),a="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};e.exports=n,s.inherits(n,i),n.prototype.all=function(e){for(var r=Object.keys(this.sessions),t=Object.create(null),n=0;n<r.length;n++){var i=r[n],s=o.call(this,i);s&&(t[i]=s)}e&&a(e,null,t)},n.prototype.clear=function(e){this.sessions=Object.create(null),e&&a(e)},n.prototype.destroy=function(e,r){delete this.sessions[e],r&&a(r)},n.prototype.get=function(e,r){a(r,null,o.call(this,e))},n.prototype.set=function(e,r,t){this.sessions[e]=JSON.stringify(r),t&&a(t)},n.prototype.length=function(e){this.all(function(r,t){return r?e(r):void e(null,Object.keys(t).length)})},n.prototype.touch=function(e,r,t){var n=o.call(this,e);n&&(n.cookie=r.cookie,this.sessions[e]=JSON.stringify(n)),t&&a(t)}},function(e,r,t){var n=t(2),o=t(8);e.exports=function(e,r){if("function"==typeof e&&(r=e,e=void 0),e=e||{},!r)throw new TypeError("oauth2orize.authorizationCode exchange requires an issue callback");var t=e.userProperty||"user";return function(e,i,s){function a(e,r,t,a){if(e)return s(e);if(!r)return s(new o("Invalid authorization code","invalid_grant"));t&&"object"==typeof t&&(a=t,t=null);var u={};u.access_token=r,t&&(u.refresh_token=t),a&&n.merge(u,a),u.token_type=u.token_type||"Bearer";var c=JSON.stringify(u);i.setHeader("Content-Type","application/json"),i.setHeader("Cache-Control","no-store"),i.setHeader("Pragma","no-cache"),i.end(c)}if(!e.body)return s(new Error("OAuth2orize requires body parsing. Did you forget app.use(express.bodyParser())?"));var u=e[t],c=e.body.code,f=e.body.redirect_uri;if(!c)return s(new o("Missing required parameter: code","invalid_request"));try{var l=r.length;6==l?r(u,c,f,e.body,e.authInfo,a):5==l?r(u,c,f,e.body,a):r(u,c,f,a)}catch(p){return s(p)}}}},function(e,r,t){var n=t(2),o=t(8);e.exports=function(e,r){if("function"==typeof e&&(r=e,e=void 0),e=e||{},!r)throw new TypeError("oauth2orize.clientCredentials exchange requires an issue callback");var t=e.userProperty||"user",i=e.scopeSeparator||" ";return Array.isArray(i)||(i=[i]),function(e,s,a){function u(e,r,t,i){if(e)return a(e);if(!r)return a(new o("Invalid client credentials","invalid_grant"));t&&"object"==typeof t&&(i=t,t=null);var u={};u.access_token=r,t&&(u.refresh_token=t),i&&n.merge(u,i),u.token_type=u.token_type||"Bearer";var c=JSON.stringify(u);s.setHeader("Content-Type","application/json"),s.setHeader("Cache-Control","no-store"),s.setHeader("Pragma","no-cache"),s.end(c)}if(!e.body)return a(new Error("OAuth2orize requires body parsing. Did you forget app.use(express.bodyParser())?"));var c=e[t],f=e.body.scope;if(f){for(var l=0,p=i.length;l<p;l++){var h=f.split(i[l]);if(h.length>1){f=h;break}}Array.isArray(f)||(f=[f])}try{var d=r.length;5==d?r(c,f,e.body,e.authInfo,u):4==d?r(c,f,e.body,u):3==d?r(c,f,u):r(c,u)}catch(y){return a(y)}}}},function(e,r,t){var n=t(2),o=t(8);e.exports=function(e,r){if("function"==typeof e&&(r=e,e=void 0),e=e||{},!r)throw new TypeError("oauth2orize.password exchange requires an issue callback");var t=e.userProperty||"user",i=e.scopeSeparator||" ";return Array.isArray(i)||(i=[i]),function(e,s,a){function u(e,r,t,i){if(e)return a(e);if(!r)return a(new o("Invalid resource owner credentials","invalid_grant"));t&&"object"==typeof t&&(i=t,t=null);var u={};u.access_token=r,t&&(u.refresh_token=t),i&&n.merge(u,i),u.token_type=u.token_type||"Bearer";var c=JSON.stringify(u);s.setHeader("Content-Type","application/json"),s.setHeader("Cache-Control","no-store"),s.setHeader("Pragma","no-cache"),s.end(c)}if(!e.body)return a(new Error("OAuth2orize requires body parsing. Did you forget app.use(express.bodyParser())?"));var c=e[t],f=e.body.username,l=e.body.password,p=e.body.scope;if(!f)return a(new o("Missing required parameter: username","invalid_request"));if(!l)return a(new o("Missing required parameter: password","invalid_request"));if(p){for(var h=0,d=i.length;h<d;h++){var y=p.split(i[h]);if(y.length>1){p=y;break}}Array.isArray(p)||(p=[p])}try{var v=r.length;7==v?r(c,f,l,p,e.body,e.authInfo,u):6==v?r(c,f,l,p,e.body,u):5==v?r(c,f,l,p,u):r(c,f,l,u)}catch(g){return a(g)}}}},function(e,r,t){var n=t(2),o=t(8);e.exports=function(e,r){if("function"==typeof e&&(r=e,e=void 0),e=e||{},!r)throw new TypeError("oauth2orize.refreshToken exchange requires an issue callback");var t=e.userProperty||"user",i=e.scopeSeparator||" ";return Array.isArray(i)||(i=[i]),function(e,s,a){function u(e,r,t,i){if(e)return a(e);if(!r)return a(new o("Invalid refresh token","invalid_grant"));t&&"object"==typeof t&&(i=t,t=null);var u={};u.access_token=r,t&&(u.refresh_token=t),i&&n.merge(u,i),u.token_type=u.token_type||"Bearer";var c=JSON.stringify(u);s.setHeader("Content-Type","application/json"),s.setHeader("Cache-Control","no-store"),s.setHeader("Pragma","no-cache"),s.end(c)}if(!e.body)return a(new Error("OAuth2orize requires body parsing. Did you forget app.use(express.bodyParser())?"));var c=e[t],f=e.body.refresh_token,l=e.body.scope;if(!f)return a(new o("Missing required parameter: refresh_token","invalid_request"));if(l){for(var p=0,h=i.length;p<h;p++){var d=l.split(i[p]);if(d.length>1){l=d;break}}Array.isArray(l)||(l=[l])}try{var y=r.length;6==y?r(c,f,l,e.body,e.authInfo,u):5==y?r(c,f,l,e.body,u):4==y?r(c,f,l,u):r(c,f,u)}catch(v){return a(v)}}}},function(e,r,t){var n=(t(9),t(4));e.exports=function(e,r){function o(e){var r=e.query.client_id,t=e.query.redirect_uri,o=e.query.scope,i=e.query.state;if(!r)throw new n("Missing required parameter: client_id","invalid_request");if(o){if("string"!=typeof o)throw new n("Invalid parameter: scope must be a string","invalid_request");for(var s=0,a=u.length;s<a;s++){var c=o.split(u[s]);if(c.length>1){o=c;break}}Array.isArray(o)||(o=[o])}return{clientID:r,redirectURI:t,scope:o,state:i}}function i(e,t,o){function i(r,i){if(r)return o(r);if(!i)return o(new n("Request denied by authorization server","access_denied"));var a={code:i};return e.req&&e.req.state&&(a.state=e.req.state),s(e,t,a)}var s,u="query";if(e.req&&e.req.responseMode&&(u=e.req.responseMode),s=a[u],!s)return o(new n("Unsupported response mode: "+u,"unsupported_response_mode",null,501));if(s&&s.validate)try{s.validate(e)}catch(c){return o(c)}if(!e.res.allow){var f={error:"access_denied"};return e.req&&e.req.state&&(f.state=e.req.state),s(e,t,f)}try{var l=r.length;7==l?r(e.client,e.req.redirectURI,e.user,e.res,e.req,e.locals,i):6==l?r(e.client,e.req.redirectURI,e.user,e.res,e.req,i):5==l?r(e.client,e.req.redirectURI,e.user,e.res,i):r(e.client,e.req.redirectURI,e.user,i)}catch(c){return o(c)}}function s(e,r,t,n){var o,i="query",s={};if(r.req&&r.req.responseMode&&(i=r.req.responseMode),o=a[i],!o)return n(e);if(o&&o.validate)try{o.validate(r)}catch(u){return n(e)}return s.error=e.code||"server_error",e.message&&(s.error_description=e.message),e.uri&&(s.error_uri=e.uri),r.req&&r.req.state&&(s.state=r.req.state),o(r,t,s)}if("function"==typeof e&&(r=e,e=void 0),e=e||{},!r)throw new TypeError("oauth2orize.code grant requires an issue callback");var a=e.modes||{};a.query||(a.query=t(25));var u=e.scopeSeparator||" ";Array.isArray(u)||(u=[u]);var c={};return c.name="code",c.request=o,c.response=i,c.error=s,c}},function(e,r,t){var n=(t(9),t(15),t(2)),o=t(4);e.exports=function(e,r){function i(e){var r=e.query.client_id,t=e.query.redirect_uri,n=e.query.scope,i=e.query.state;if(!r)throw new o("Missing required parameter: client_id","invalid_request");if(n){if("string"!=typeof n)throw new o("Invalid parameter: scope must be a string","invalid_request");for(var s=0,a=c.length;s<a;s++){var u=n.split(c[s]);if(u.length>1){n=u;break}}Array.isArray(n)||(n=[n])}return{clientID:r,redirectURI:t,scope:n,state:i}}function s(e,t,i){function s(r,s,u){if(r)return i(r);if(!s)return i(new o("Request denied by authorization server","access_denied"));var c={};return c.access_token=s,u&&n.merge(c,u),c.token_type=c.token_type||"Bearer",e.req&&e.req.state&&(c.state=e.req.state),a(e,t,c)}var a,c="fragment";if(e.req&&e.req.responseMode&&(c=e.req.responseMode),a=u[c],!a)return i(new o("Unsupported response mode: "+c,"unsupported_response_mode",null,501));if(a&&a.validate)try{a.validate(e)}catch(f){return i(f)}if(!e.res.allow){var l={error:"access_denied"};return e.req&&e.req.state&&(l.state=e.req.state),a(e,t,l)}try{var p=r.length;6==p?r(e.client,e.user,e.res,e.req,e.locals,s):5==p?r(e.client,e.user,e.res,e.req,s):4==p?r(e.client,e.user,e.res,s):r(e.client,e.user,s)}catch(f){return i(f)}}function a(e,r,t,n){var o,i="fragment",s={};if(r.req&&r.req.responseMode&&(i=r.req.responseMode),o=u[i],!o)return n(e);if(o&&o.validate)try{o.validate(r)}catch(a){return n(e)}return s.error=e.code||"server_error",e.message&&(s.error_description=e.message),e.uri&&(s.error_uri=e.uri),r.req&&r.req.state&&(s.state=r.req.state),o(r,t,s)}if("function"==typeof e&&(r=e,e=void 0),e=e||{},!r)throw new TypeError("oauth2orize.token grant requires an issue callback");var u=e.modes||{};u.fragment||(u.fragment=t(24));var c=e.scopeSeparator||" ";Array.isArray(c)||(c=[c]);var f={};return f.name="token",f.request=i,f.response=s,f.error=a,f}},function(e,r,t){function n(e){var r=new o(e);return r}var o=(t(108),t(110),t(80));r=e.exports=n,r.createServer=n,r.errorHandler=t(23),r.grant={},r.grant.authorizationCode=r.grant.code=t(71),r.grant.implicit=r.grant.token=t(72),r.exchange={},r.exchange.code=r.exchange.authorizationCode=t(67),r.exchange.clientCredentials=t(68),r.exchange.password=t(69),r.exchange.refreshToken=t(70),r.OAuth2Error=t(14),r.AuthorizationError=t(4),r.TokenError=t(8)},function(e,r,t){var n=(t(2),t(4));e.exports=function(e,r,t,o){if("function"==typeof r&&(o=t,t=r,r=void 0),r=r||{},o=o||function(e,r,t){return t(null,!1)},!e)throw new TypeError("oauth2orize.authorization middleware requires a server argument");if(!t)throw new TypeError("oauth2orize.authorization middleware requires a validate function");var i=r.userProperty||"user";return function(s,a,u){if(!s.session)return u(new Error("OAuth2orize requires session support. Did you forget app.use(express.session(...))?"));var c=s.body||{},f=s.query.response_type||c.response_type;e._parse(f,s,function(c,l){function p(t,c,f){function p(t,o,i,p){function h(e,r){return e?u(e):(s.oauth2.transactionID=r,void u())}if(t)return u(t);if(o)s.oauth2.res=i||{},s.oauth2.res.allow=!0,s.oauth2.locals=p,e._respond(s.oauth2,a,function(e){return u(e?e:new n("Unsupported response type: "+s.oauth2.req.type,"unsupported_response_type"))});else{s.oauth2.info=i,s.oauth2.locals=p;var d={};d.protocol="oauth2",d.client=c,d.redirectURI=f,d.req=l,d.info=i,1==e._txnStore.legacy&&e._txnStore.store(e,r,s,d,h)}}if(s.oauth2={},c&&(s.oauth2.client=c),f&&(s.oauth2.redirectURI=f),s.oauth2.req=l,s.oauth2.user=s[i],t)return u(t);if(!c)return u(new n("Unauthorized client","unauthorized_client"));var h=o.length;4==h?o(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,p):5==h?o(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,s.oauth2.req.type,p):6==h?o(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,s.oauth2.req.type,s.oauth2.req,p):7==h?o(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,s.oauth2.req.type,s.oauth2.req,s.oauth2.locals,p):o(s.oauth2.client,s.oauth2.user,p)}if(c)return u(c);if(!l||!l.type)return u(new n("Missing required parameter: response_type","invalid_request"));if(l.type&&!l.clientID)return u(new n("Unsupported response type: "+f,"unsupported_response_type"));try{var h=t.length;3==h?t(l.clientID,l.redirectURI,p):4==h?t(l.clientID,l.redirectURI,l.scope,p):5==h?t(l.clientID,l.redirectURI,l.scope,l.type,p):t(l,p)}catch(d){return u(d)}})}}},function(e,r){e.exports=function(e,r){if(r=r||{},!e)throw new TypeError("oauth2orize.authorizationErrorHandler middleware requires a server argument");return function(t,n,o,i){if(!n.oauth2)return i(t);if(n.oauth2.transactionID&&!n.oauth2._endProxied){var s=o.end;o.end=function(t,i){1==e._txnStore.legacy&&e._txnStore.remove(r,n,n.oauth2.transactionID,function(){}),o.end=s,o.end(t,i)}}e._respondError(t,n.oauth2,o,function(e){return i(e)})}}},function(e,r,t){var n=t(2),o=t(4);t(13),e.exports=function(e,r,t){if("function"==typeof r&&(t=r,r=void 0),r=r||{},t=t||function(e,r){return r()},!e)throw new TypeError("oauth2orize.decision middleware requires a server argument");var i=r.cancelField||"cancel",s=r.userProperty||"user";return function(a,u,c){return a.body?a.oauth2?void t(a,function(t,f,l){if(t)return c(t);a.oauth2.transactionID,a.oauth2.user=a[s],a.oauth2.res=f||{},l&&(a.oauth2.locals=a.oauth2.locals||{},n.merge(a.oauth2.locals,l)),void 0===a.oauth2.res.allow&&(a.body[i]?a.oauth2.res.allow=!1:a.oauth2.res.allow=!0);var p=u.end;u.end=function(t,n){1==e._txnStore.legacy&&e._txnStore.remove(r,a,a.oauth2.transactionID,function(){}),u.end=p,u.end(t,n)},a.oauth2._endProxied=!0,e._respond(a.oauth2,u,function(e){return c(e?e:new o("Unsupported response type: "+a.oauth2.req.type,"unsupported_response_type"))})}):c(new Error("OAuth2orize requires transaction support. Did you forget oauth2orize.transactionLoader(...)?")):c(new Error("OAuth2orize requires body parsing. Did you forget app.use(express.bodyParser())?"))}}},function(e,r,t){var n=t(2),o=t(4);e.exports=function(e,r,t){if("function"==typeof r&&(t=r,r=void 0),r=r||{},!e)throw new TypeError("oauth2orize.resume middleware requires a server argument");if(!t)throw new TypeError("oauth2orize.resume middleware requires an immediate function");var i=r.userProperty||"user";return function(s,a,u){function c(t,i,c,f){function l(e){return e?u(e):void u()}if(t)return u(t);if(i){s.oauth2.res=c||{},s.oauth2.res.allow=!0,f&&(s.oauth2.locals=s.oauth2.locals||{},n.merge(s.oauth2.locals,f));var p=a.end;a.end=function(t,n){1==e._txnStore.legacy&&e._txnStore.remove(r,s,s.oauth2.transactionID,function(){}),a.end=p,a.end(t,n)},s.oauth2._endProxied=!0,e._respond(s.oauth2,a,function(e){return u(e?e:new o("Unsupported response type: "+s.oauth2.req.type,"unsupported_response_type"))})}else if(s.oauth2.info=c,f&&(s.oauth2.locals=s.oauth2.locals||{},n.merge(s.oauth2.locals,f)),1==e._txnStore.legacy){var h={};h.protocol="oauth2",h.client=s.oauth2.client,h.redirectURI=s.oauth2.redirectURI,h.req=s.oauth2.req,h.info=c,e._txnStore.update(e,r,s,s.oauth2.transactionID,h,l)}}if(!s.oauth2)return u(new Error("OAuth2orize requires transaction support. Did you forget oauth2orize.transactionLoader(...)?"));s.oauth2.user=s[i],a.locals&&(s.oauth2.locals=s.oauth2.locals||{},n.merge(s.oauth2.locals,a.locals));try{var f=t.length;4==f?t(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,c):5==f?t(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,s.oauth2.req.type,c):6==f?t(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,s.oauth2.req.type,s.oauth2.req,c):7==f?t(s.oauth2.client,s.oauth2.user,s.oauth2.req.scope,s.oauth2.req.type,s.oauth2.req,s.oauth2.locals,c):t(s.oauth2.client,s.oauth2.user,c)}catch(l){return u(l)}}}},function(e,r,t){var n=t(8);e.exports=function(e,r){if(r=r||{},!e)throw new TypeError("oauth2orize.token middleware requires a server argument");return function(r,t,o){var i=r.body.grant_type;e._exchange(i,r,t,function(e){return o(e?e:new n("Unsupported grant type: "+i,"unsupported_grant_type"))})}}},function(e,r,t){t(4),t(22),t(13),e.exports=function(e,r){if(r=r||{},!e)throw new TypeError("oauth2orize.transactionLoader middleware requires a server argument");return function(t,n,o){function i(e,r){return e?o(e):(t.oauth2=r,void o())}return t.oauth2?o():void(1==e._txnStore.legacy&&e._txnStore.load(e,r,t,i))}}},function(e,r,t){function n(e){e=e||{},this._reqParsers=[],this._resHandlers=[],this._errHandlers=[],this._exchanges=[],this._serializers=[],this._deserializers=[],this._txnStore=e.store||new o}var o=t(81),i=t(26),s=t(74),a=t(77),u=t(76),c=t(79),f=t(78),l=t(75),p=t(23),h=t(2),d=t(6)("oauth2orize");n.prototype.grant=function(e,r,t){if("object"==typeof e){var n=e;return n.request&&this.grant(n.name,"request",n.request),n.response&&this.grant(n.name,"response",n.response),n.error&&this.grant(n.name,"error",n.error),this}if("object"==typeof r){var n=r;return n.request&&this.grant(e,"request",n.request),n.response&&this.grant(e,"response",n.response),n.error&&this.grant(e,"error",n.error),this}return"function"==typeof r&&(t=r,r="request"),"*"===e&&(e=null),e&&(e=new i(e)),"request"==r?(d("register request parser %s %s",e||"*",t.name||"anonymous"),this._reqParsers.push({type:e,handle:t})):"response"==r?(d("register response handler %s %s",e||"*",t.name||"anonymous"),this._resHandlers.push({type:e,handle:t})):"error"==r&&(d("register error handler %s %s",e||"*",t.name||"anonymous"),this._errHandlers.push({type:e,handle:t})),this},n.prototype.exchange=function(e,r){return"function"==typeof e&&(r=e,e=r.name),"*"===e&&(e=null),d("register exchanger %s %s",e||"*",r.name||"anonymous"),this._exchanges.push({type:e,handle:r}),this},n.prototype.authorize=n.prototype.authorization=function(e,r,t){return s(this,e,r,t)},n.prototype.resume=function(e,r){return e&&e.loadTransaction===!1?a(this,e,r):[c(this,e),a(this,e,r)]},n.prototype.decision=function(e,r){return e&&e.loadTransaction===!1?u(this,e,r):[c(this,e),u(this,e,r)]},n.prototype.authorizeError=n.prototype.authorizationError=n.prototype.authorizationErrorHandler=function(e){var r=c(this,e);return[function(e,t,n,o){r(t,n,function(r){return o(e)})},l(this,e)]},n.prototype.token=function(e){return f(this,e)},n.prototype.errorHandler=function(e){return p(e)},n.prototype.serializeClient=function(e,r){if("function"==typeof e)return this._serializers.push(e);var t=e,n=this._serializers;!function o(e,i,s){if("pass"===i&&(i=void 0),i||s)return r(i,s);var a=n[e];if(!a)return r(new Error("Failed to serialize client. Register serialization function using serializeClient()."));try{a(t,function(r,t){o(e+1,r,t)})}catch(u){return r(u)}}(0)},n.prototype.deserializeClient=function(e,r){if("function"==typeof e)return this._deserializers.push(e);var t=e,n=this._deserializers;!function o(e,i,s){if("pass"===i&&(i=void 0),i||s)return r(i,s);if(null===s||s===!1)return r(null,!1);var a=n[e];if(!a)return r(new Error("Failed to deserialize client. Register deserialization function using deserializeClient()."));try{a(t,function(r,t){o(e+1,r,t)})}catch(u){return r(u)}}(0)},n.prototype._parse=function(e,r,t){var n=new i(e),o=this._reqParsers,s={};e&&(s.type=e),function a(e){var i=o[e];if(!i)return t(null,s);try{if(d("parse:%s",i.handle.name||"anonymous"),null===i.type||i.type.equalTo(n)){var u=i.handle.length;if(1==u){var c=i.handle(r);h.merge(s,c),a(e+1)}else i.handle(r,function(r,n){return r?t(r):(h.merge(s,n),void a(e+1))})}else a(e+1)}catch(f){return t(f)}}(0)},n.prototype._respond=function(e,r,t){function n(i){if(i)return t(i);var u=s[a++];if(!u)return t();try{d("respond:%s",u.handle.name||"anonymous"),null===u.type||u.type.equalTo(o)?u.handle(e,r,n):n()}catch(c){return t(c)}}var o=new i(e.req.type),s=this._resHandlers,a=0;n()},n.prototype._respondError=function(e,r,t,n){function o(e){var i=a[u++];if(!i)return n(e);try{d("error:%s",i.handle.name||"anonymous"),null===i.type||i.type.equalTo(s)?i.handle(e,r,t,o):o(e)}catch(c){return n(c)}}var s=new i(r.req.type),a=this._errHandlers,u=0;o(e)},n.prototype._exchange=function(e,r,t,n){function o(a){if(a)return n(a);var u=i[s++];if(!u)return n();try{d("exchange:%s",u.handle.name||"anonymous"),null===u.type||u.type===e?u.handle(r,t,o):o()}catch(c){return n(c)}}var i=this._exchanges,s=0;o()},r=e.exports=n},function(e,r,t){function n(){this.legacy=!0}var o=t(2),i=t(4),s=t(22),a=t(13);n.prototype.load=function(e,r,t,n){var o=r.transactionField||"transaction_id",u=r.sessionKey||"authorize";if(!t.session)return n(new Error("OAuth2orize requires session support. Did you forget app.use(express.session(...))?"));if(!t.session[u])return n(new a("Unable to load OAuth 2.0 transactions from session"));var c=t.query||{},f=t.body||{},l=c[o]||f[o];if(!l)return n(new s("Missing required parameter: "+o));var p=t.session[u][l];if(!p)return n(new a("Unable to load OAuth 2.0 transaction: "+l));
var h=this;e.deserializeClient(p.client,function(e,o){return e?n(e):o?(p.transactionID=l,p.client=o,void n(null,p)):void h.remove(r,t,l,function(e){return n(e?e:new i("Unauthorized client","unauthorized_client"))})})},n.prototype.store=function(e,r,t,n,i){var s=r.idLength||8,a=r.sessionKey||"authorize";e.serializeClient(n.client,function(e,r){if(e)return i(e);var u=o.uid(s);n.client=r;var c=t.session[a]=t.session[a]||{};c[u]=n,i(null,u)})},n.prototype.update=function(e,r,t,n,o,i){var s=r.sessionKey||"authorize";e.serializeClient(o.client,function(e,r){if(e)return i(e);o.client=r;var a=t.session[s]=t.session[s]||{};a[n]=o,i(null)})},n.prototype.remove=function(e,r,t,n){var o=e.sessionKey||"authorize";return r.session?(r.session[o]&&delete r.session[o][t],void n()):n(new Error("OAuth2orize requires session support. Did you forget app.use(express.session(...))?"))},e.exports=n},65,function(e,r,t){var n=t(84);r=e.exports=n,r.Strategy=n},function(e,r,t){function n(e){if(!e)throw new TypeError("CustomStrategy requires a verify callback");o.Strategy.call(this),this.name="custom",this._verify=e}var o=t(85),i=t(5);i.inherits(n,o.Strategy),n.prototype.authenticate=function(e){function r(e,r,n){return e?t.error(e):r?void t.success(r,n):t.fail(n)}var t=this;try{this._verify(e,r)}catch(n){return t.error(n)}},e.exports=n},[114,86],function(e,r){function t(){}t.prototype.authenticate=function(e,r){throw new Error("Strategy#authenticate must be overridden by subclass")},e.exports=t},[114,88],function(e,r,t){function n(e,r){if("function"==typeof e&&(r=e,e={}),!r)throw new TypeError("HTTPBearerStrategy requires a verify callback");o.Strategy.call(this),this.name="bearer",this._verify=r,this._realm=e.realm||"Users",e.scope&&(this._scope=Array.isArray(e.scope)?e.scope:[e.scope]),this._passReqToCallback=e.passReqToCallback}var o=t(89),i=t(5);i.inherits(n,o.Strategy),n.prototype.authenticate=function(e){function r(e,r,t){return e?s.error(e):r?void s.success(r,t):("string"==typeof t&&(t={message:t}),t=t||{},s.fail(s._challenge("invalid_token",t.message)))}var t;if(e.headers&&e.headers.authorization){var n=e.headers.authorization.split(" ");if(2!=n.length)return this.fail(400);var o=n[0],i=n[1];/^Bearer$/i.test(o)&&(t=i)}if(e.body&&e.body.access_token){if(t)return this.fail(400);t=e.body.access_token}if(e.query&&e.query.access_token){if(t)return this.fail(400);t=e.query.access_token}if(!t)return this.fail(this._challenge());var s=this;s._passReqToCallback?this._verify(e,t,r):this._verify(t,r)},n.prototype._challenge=function(e,r,t){var n='Bearer realm="'+this._realm+'"';return this._scope&&(n+=', scope="'+this._scope.join(" ")+'"'),e&&(n+=', error="'+e+'"'),r&&r.length&&(n+=', error_description="'+r+'"'),t&&t.length&&(n+=', error_uri="'+t+'"'),n},e.exports=n},[114,90],86,function(e,r,t){var n=t(92),o=t(93);r.BasicStrategy=n,r.DigestStrategy=o},function(e,r,t){function n(e,r){if("function"==typeof e&&(r=e,e={}),!r)throw new Error("HTTP Basic authentication strategy requires a verify function");o.Strategy.call(this),this.name="basic",this._verify=r,this._realm=e.realm||"Users",this._passReqToCallback=e.passReqToCallback}var o=t(27),i=t(5);i.inherits(n,o.Strategy),n.prototype.authenticate=function(e){function r(e,r){return e?u.error(e):r?void u.success(r):u.fail(u._challenge())}var t=e.headers.authorization;if(!t)return this.fail(this._challenge());var n=t.split(" ");if(n.length<2)return this.fail(400);var o=n[0],i=new Buffer(n[1],"base64").toString().split(":");if(!/Basic/i.test(o))return this.fail(this._challenge());if(i.length<2)return this.fail(400);var s=i[0],a=i[1];if(!s||!a)return this.fail(this._challenge());var u=this;u._passReqToCallback?this._verify(e,s,a,r):this._verify(s,a,r)},n.prototype._challenge=function(){return'Basic realm="'+this._realm+'"'},e.exports=n},function(e,r,t){function n(e,r,t){if("function"==typeof e&&(t=r,r=e,e={}),!r)throw new Error("HTTP Digest authentication strategy requires a secret function");a.Strategy.call(this),this.name="digest",this._secret=r,this._validate=t,this._realm=e.realm||"Users",e.domain&&(this._domain=Array.isArray(e.domain)?e.domain:[e.domain]),this._opaque=e.opaque,this._algorithm=e.algorithm,e.qop&&(this._qop=Array.isArray(e.qop)?e.qop:[e.qop])}function o(e){for(var r={},t=e.split(/,(?=(?:[^"]|"[^"]*")*$)/),n=0,o=t.length;n<o;n++){var i=/(\w+)=["]?([^"]+)["]?$/.exec(t[n]);i&&(r[i[1]]=i[2])}return r}function i(e){for(var r=[],t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,o=0;o<e;++o)r.push(t[Math.random()*n|0]);return r.join("")}function s(e,r){return u.createHash("md5").update(e).digest(r||"hex")}var a=t(27),u=t(33),c=t(5);c.inherits(n,a.Strategy),n.prototype.authenticate=function(e){var r=e.headers.authorization;if(!r)return this.fail(this._challenge());var t=r.split(" ");if(t.length<2)return this.fail(400);var n=t[0],i=t.slice(1).join(" ");if(!/Digest/i.test(n))return this.fail(this._challenge());var a=o(i);if(0===Object.keys(a).length)return this.fail(400);if(!a.username)return this.fail(this._challenge());if(e.url!==a.uri)return this.fail(400);var u=this;this._secret(a.username,function(r,t,n){if(r)return u.error(r);if(!t)return u.fail(u._challenge());var o;if(a.algorithm&&"MD5"!==a.algorithm){if("MD5-sess"!==a.algorithm)return u.fail(400);o=s(s(a.username+":"+a.realm+":"+n)+":"+a.nonce+":"+a.cnonce)}else o="object"==typeof n&&n.ha1?n.ha1:s(a.username+":"+a.realm+":"+n);var i;if(a.qop&&"auth"!==a.qop)return"auth-int"===a.qop?u.error(new Error("auth-int not implemented")):u.fail(400);i=s(e.method+":"+a.uri);var c;if(a.qop){if("auth"!==a.qop&&"auth-int"!==a.qop)return u.fail(400);c=s(o+":"+a.nonce+":"+a.nc+":"+a.cnonce+":"+a.qop+":"+i)}else c=s(o+":"+a.nonce+":"+i);return a.response!=c?u.fail(u._challenge()):void(u._validate?u._validate({nonce:a.nonce,cnonce:a.cnonce,nc:a.nc,opaque:a.opaque},function(e,r){return e?u.error(e):r?void u.success(t):u.fail(u._challenge())}):u.success(t))})},n.prototype._challenge=function(){var e='Digest realm="'+this._realm+'"';return this._domain&&(e+=', domain="'+this._domain.join(" ")+'"'),e+=', nonce="'+i(32)+'"',this._opaque&&(e+=', opaque="'+this._opaque+'"'),this._algorithm&&(e+=", algorithm="+this._algorithm),this._qop&&(e+=', qop="'+this._qop.join(",")+'"'),e},e.exports=n},86,[114,96],function(e,r,t){function n(e,r){if("function"==typeof e&&(r=e,e={}),!r)throw new Error("OAuth 2.0 client password strategy requires a verify function");o.Strategy.call(this),this.name="oauth2-client-password",this._verify=r,this._passReqToCallback=e.passReqToCallback}var o=t(97),i=t(5);i.inherits(n,o.Strategy),n.prototype.authenticate=function(e){function r(e,r,t){return e?o.error(e):r?void o.success(r,t):o.fail()}if(!e.body||!e.body.client_id||!e.body.client_secret)return this.fail();var t=e.body.client_id,n=e.body.client_secret,o=this;o._passReqToCallback?this._verify(e,t,n,r):this._verify(t,n,r)},e.exports=n},[114,98],86,function(e,r,t){function n(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this._userProperty="user",this.init()}var o=t(30);n.prototype.init=function(){this.framework(t(28)()),this.use(new o)},n.prototype.use=function(e,r){if(r||(r=e,e=r.name),!e)throw new Error("Authentication strategies must have a name");return this._strategies[e]=r,this},n.prototype.unuse=function(e){return delete this._strategies[e],this},n.prototype.framework=function(e){return this._framework=e,this},n.prototype.initialize=function(e){return e=e||{},this._userProperty=e.userProperty||"user",this._framework.initialize(this,e)},n.prototype.authenticate=function(e,r,t){return this._framework.authenticate(this,e,r,t)},n.prototype.authorize=function(e,r,t){r=r||{},r.assignProperty="account";var n=this._framework.authorize||this._framework.authenticate;return n(this,e,r,t)},n.prototype.session=function(e){return this.authenticate("session",e)},n.prototype.serializeUser=function(e,r,t){if("function"==typeof e)return this._serializers.push(e);var n=e;"function"==typeof r&&(t=r,r=void 0);var o=this._serializers;!function i(e,s,a){function u(r,t){i(e+1,r,t)}if("pass"===s&&(s=void 0),s||a||0===a)return t(s,a);var c=o[e];if(!c)return t(new Error("Failed to serialize user into session"));try{var f=c.length;3==f?c(r,n,u):c(n,u)}catch(l){return t(l)}}(0)},n.prototype.deserializeUser=function(e,r,t){if("function"==typeof e)return this._deserializers.push(e);var n=e;"function"==typeof r&&(t=r,r=void 0);var o=this._deserializers;!function i(e,s,a){function u(r,t){i(e+1,r,t)}if("pass"===s&&(s=void 0),s||a)return t(s,a);if(null===a||a===!1)return t(null,!1);var c=o[e];if(!c)return t(new Error("Failed to deserialize user out of session"));try{var f=c.length;3==f?c(r,n,u):c(n,u)}catch(l){return t(l)}}(0)},n.prototype.transformAuthInfo=function(e,r,t){if("function"==typeof e)return this._infoTransformers.push(e);var n=e;"function"==typeof r&&(t=r,r=void 0);var o=this._infoTransformers;!function i(e,s,a){function u(r,t){i(e+1,r,t)}if("pass"===s&&(s=void 0),s||a)return t(s,a);var c=o[e];if(!c)return t(null,n);try{var f=c.length;if(1==f){var l=c(n);u(null,l)}else 3==f?c(r,n,u):c(n,u)}catch(p){return t(p)}}(0)},n.prototype._strategy=function(e){return this._strategies[e]},e.exports=n},function(e,r){function t(e,r){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=e,this.status=r||401}t.prototype.__proto__=Error.prototype,e.exports=t},function(e,r,t){var n=t(35),o=t(29),i=t(100);e.exports=function(e,r,s,a){"function"==typeof s&&(a=s,s={}),s=s||{};var u=!0;return Array.isArray(r)||(r=[r],u=!1),function(c,f,l){function p(){if(a){if(u){var e=h.map(function(e){return e.challenge}),r=h.map(function(e){return e.status});return a(null,!1,e,r)}return a(null,!1,h[0].challenge,h[0].status)}var t,o=h[0]||{},p=o.challenge||{};if(s.failureFlash){var d=s.failureFlash;"string"==typeof d&&(d={type:"error",message:d}),d.type=d.type||"error";var y=d.type||p.type||"error";t=d.message||p.message||p,"string"==typeof t&&c.flash(y,t)}if(s.failureMessage&&(t=s.failureMessage,"boolean"==typeof t&&(t=p.message||p),"string"==typeof t&&(c.session.messages=c.session.messages||[],c.session.messages.push(t))),s.failureRedirect)return f.redirect(s.failureRedirect);for(var v,g,_=[],m=0,w=h.length;m<w;m++)o=h[m],p=o.challenge,g=o.status,v=v||g,"string"==typeof p&&_.push(p);return f.statusCode=v||401,401==f.statusCode&&_.length&&f.setHeader("WWW-Authenticate",_),s.failWithError?l(new i(n.STATUS_CODES[f.statusCode],v)):void f.end(n.STATUS_CODES[f.statusCode])}n.IncomingMessage.prototype.logIn&&n.IncomingMessage.prototype.logIn!==o.logIn&&t(28).__monkeypatchNode();var h=[];!function d(t){var n=r[t];if(!n)return p();var o=e._strategy(n);if(!o)return l(new Error('Unknown authentication strategy "'+n+'"'));var i=Object.create(o);i.success=function(r,t){if(a)return a(null,r,t);t=t||{};var n;if(s.successFlash){var o=s.successFlash;"string"==typeof o&&(o={type:"success",message:o}),o.type=o.type||"success";var i=o.type||t.type||"success";n=o.message||t.message||t,"string"==typeof n&&c.flash(i,n)}return s.successMessage&&(n=s.successMessage,"boolean"==typeof n&&(n=t.message||t),"string"==typeof n&&(c.session.messages=c.session.messages||[],c.session.messages.push(n))),s.assignProperty?(c[s.assignProperty]=r,l()):void c.logIn(r,s,function(r){function n(){if(s.successReturnToOrRedirect){var e=s.successReturnToOrRedirect;return c.session&&c.session.returnTo&&(e=c.session.returnTo,delete c.session.returnTo),f.redirect(e)}return s.successRedirect?f.redirect(s.successRedirect):void l()}return r?l(r):void(s.authInfo!==!1?e.transformAuthInfo(t,c,function(e,r){return e?l(e):(c.authInfo=r,void n())}):n())})},i.fail=function(e,r){"number"==typeof e&&(r=e,e=void 0),h.push({challenge:e,status:r}),d(t+1)},i.redirect=function(e,r){f.statusCode=r||302,f.setHeader("Location",e),f.setHeader("Content-Length","0"),f.end()},i.pass=function(){l()},i.error=function(e){return a?a(e):void l(e)},i.authenticate(c,s)}(0)}}},function(e,r){e.exports=function(e){return function(r,t,n){r._passport={},r._passport.instance=e,r.session&&r.session[e._key]&&(r._passport.session=r.session[e._key]),n()}}},86,function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("cookie-signature")},function(e,r){e.exports=require("depd")},function(e,r){e.exports=require("events")},function(e,r){e.exports=require("fs")},function(e,r){e.exports=require("lokijs")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("pause")},function(e,r){e.exports=require("uid2")},function(e,r){e.exports=require("webtask-tools")},function(e,r,t,n){var o=t(n);r=e.exports=o,r.Strategy=o}]));